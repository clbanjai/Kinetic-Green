<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Texas County-Level Energy Demand Map</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.3/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.3/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <style>
        body {
            margin: 0;
            background-color: black;
            color: white;
        }

        #map {
            height: 100vh;
            width: 100%;
        }

        .legend {
            background: white;
            padding: 10px;
            font-size: 12px;
            color: black;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <script>
        // Create the map object and set its view to Texas
        const map = L.map('map').setView([31.0, -99.0], 6);

        // Use a dark tile layer for the map background
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attribution">CARTO</a>',
            opacity: 1
        }).addTo(map);

        // Function to set color based on energy demand value
        function getColor(d) {
            return d > 1000 ? '#800026' :
                   d > 500  ? '#BD0026' :
                   d > 200  ? '#E31A1C' :
                   d > 100  ? '#FC4E2A' :
                   d > 50   ? '#FD8D3C' :
                   d > 20   ? '#FEB24C' :
                   d > 10   ? '#FED976' :
                              '#FFEDA0';
        }

        // Adding geoJSON layer for Texas counties with energy demand data
        async function loadCountyData() {
            const response = await fetch('https://raw.githubusercontent.com/plotly/datasets/master/geojson-counties-fips.json');
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const data = await response.json();

            // Placeholder energy demand data (replace with actual data)
            const energyDemand = {
                "48001": 300,
                "48003": 120,
                "48005": 50,
                // ... more counties
            };

            // Add counties to the map
            const geoJsonLayer = L.geoJson(data, {
                style: function (feature) {
                    const fips = feature.properties.GEOID;
                    const demand = energyDemand[fips] || 0;
                    return {
                        fillColor: getColor(demand),
                        weight: 1,
                        opacity: 1,
                        color: 'white',
                        fillOpacity: 0.7
                    };
                },
                onEachFeature: function (feature, layer) {
                    layer.on({
                        mouseover: function (e) {
                            e.target.setStyle({
                                weight: 3,
                                color: '#666',
                                fillOpacity: 0.9
                            });
                        },
                        mouseout: function (e) {
                            geoJsonLayer.resetStyle(e.target);
                        },
                    });
                    layer.bindPopup(`<b>County:</b> ${feature.properties.NAME}<br>
                    <b>Energy Demand:</b> ${energyDemand[feature.properties.GEOID] || "2MWh"} <br> 
                    <b> Cost: </b> ${energyDemand[feature.properties.GEOID] || "5,000,000 USD"}`);
                }
            }).addTo(map);
        }

        loadCountyData();
    </script>
</body>
</html>
